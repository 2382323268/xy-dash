{"version":3,"file":"js/691.f5781bf6.js","mappings":"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","sources":["webpack://xy-dash-admin/./src/views/config/sources/components/dialog.vue","webpack://xy-dash-admin/./src/views/config/sources/components/dialog.vue?1b2f","webpack://xy-dash-admin/./src/views/config/sources/index.vue","webpack://xy-dash-admin/./src/views/config/sources/index.vue?86b5"],"sourcesContent":["<template>\r\n  <el-dialog\r\n    :modelValue=\"dialogVisible\"\r\n    :title=\"dialogTitle\"\r\n    width=\"30%\"\r\n    clearValidate:\r\n    @close=\"handleClose\"\r\n  >\r\n    <el-form ref=\"formRef\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\r\n      <el-form-item label=\"数据源名称\" prop=\"name\">\r\n        <el-input v-model=\"form.name\" />\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"主机\" prop=\"ip\">\r\n        <el-input v-model=\"form.ip\" />\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"端口\" style=\"width: 180px\" prop=\"port\">\r\n        <el-input v-model=\"form.port\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"用户名\" style=\"width: 300px\" prop=\"userName\">\r\n        <el-input v-model=\"form.userName\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"密码\" style=\"width: 300px\" prop=\"password\">\r\n        <el-input v-model=\"form.password\" type=\"password\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"类型\" prop=\"type\">\r\n        <el-radio-group v-model=\"form.type\">\r\n          <el-radio :label=\"0\">mysql</el-radio>\r\n          <el-radio :label=\"1\">sqlserver</el-radio>\r\n        </el-radio-group>\r\n      </el-form-item>\r\n    </el-form>\r\n    <template #footer>\r\n      <el-button class=\"test\" plain @click=\"connect\">测试连接</el-button>\r\n      <span class=\"dialog-footer\">\r\n        <el-button type=\"primary\" @click=\"handleConfirm\">确认</el-button>\r\n        <el-button @click=\"handleClose\">取消</el-button>\r\n      </span>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { defineEmits, defineProps, ref, watch } from \"vue\";\r\nimport requestUtil, { getServerUrl } from \"@/util/request\";\r\nimport { ElMessage } from \"element-plus\";\r\n\r\nconst props = defineProps({\r\n  id: {\r\n    type: Number,\r\n    default: -1,\r\n    required: true,\r\n  },\r\n  dialogTitle: {\r\n    type: String,\r\n    default: \"\",\r\n    required: true,\r\n  },\r\n  dialogVisible: {\r\n    type: Boolean,\r\n    default: false,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst form = ref({\r\n  id: -1,\r\n  userName: \"\",\r\n  password: \"\",\r\n  type: 0,\r\n  port: null,\r\n  name: \"\",\r\n  ip: \"\",\r\n});\r\n\r\nconst rules = ref({\r\n  userName: [{ required: true, message: \"请输入用户名\" }],\r\n  password: [{ required: true, message: \"密码不能为空\" }],\r\n  port: [{ required: true, message: \"端口不能为空\" }],\r\n  name: [{ required: true, message: \"数据源名称不能为空\" }],\r\n  ip: [{ required: true, message: \"主机不能为空\" }],\r\n});\r\n\r\nconst formRef = ref(null);\r\n\r\nconst initFormData = async (id) => {\r\n  const res = await requestUtil.get(\"admin_api/v1/dataSources/\" + id);\r\n  form.value = res.data.data;\r\n};\r\n\r\nconst connect = async () => {\r\n  formRef.value.validate(async (valid) => {\r\n    if (valid) {\r\n      const res = await requestUtil.post(\r\n        \"admin_api/v1/dataBase/connect\",\r\n        form.value\r\n      );\r\n      if (res.data.success) {\r\n        ElMessage.success(\"连接成功！\");\r\n      } else {\r\n        ElMessage.error(\"连接失败！\");\r\n      }\r\n    } else {\r\n      console.log(\"fail\");\r\n    }\r\n  });\r\n};\r\n\r\nwatch(\r\n  () => props.dialogVisible,\r\n  () => {\r\n    let id = props.id;\r\n    if (id != -1) {\r\n      initFormData(id);\r\n    } else {\r\n      form.value = {\r\n        id: -1,\r\n        userName: \"\",\r\n        password: \"\",\r\n        type: 0,\r\n        port: null,\r\n        name: \"\",\r\n        ip: \"\",\r\n      };\r\n    }\r\n  }\r\n);\r\n\r\nconst emits = defineEmits([\"update:modelValue\", \"initUserList\"]);\r\n\r\nconst handleClose = () => {\r\n  formRef.value.resetFields();\r\n  emits(\"update:modelValue\", false);\r\n};\r\n\r\nconst handleConfirm = () => {\r\n  formRef.value.validate(async (valid) => {\r\n    if (valid) {\r\n      if (form.value.id == -1) {\r\n        let result = await requestUtil.post(\r\n          \"admin_api/v1/dataSources\",\r\n          form.value\r\n        );\r\n        refresh(result);\r\n      } else {\r\n        let result = await requestUtil.post(\r\n          \"admin_api/v1/dataSources/\" + form.value.id,\r\n          form.value\r\n        );\r\n        refresh(result);\r\n      }\r\n    } else {\r\n      console.log(\"fail\");\r\n    }\r\n  });\r\n};\r\n\r\nconst refresh = (result) => {\r\n  let success = result.data.success;\r\n  if (success) {\r\n    ElMessage.success(\"执行成功！\");\r\n    formRef.value.resetFields();\r\n    emits(\"initUserList\");\r\n    handleClose();\r\n  } else {\r\n    ElMessage.error(result.data.msg);\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.el-form-item {\r\n  margin-bottom: 25px;\r\n}\r\n.test {\r\n  display: inline;\r\n  float: left;\r\n}\r\n</style>\r\n","import script from \"./dialog.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./dialog.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./dialog.vue?vue&type=style&index=0&id=1d95a88f&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\bs\\\\wxw\\\\xy-dash-admin\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1d95a88f\"]])\n\nexport default __exports__","<template>\r\n  <el-row :gutter=\"20\" class=\"header\">\r\n    <el-col :span=\"4\">\r\n      <el-input\r\n        placeholder=\"请输入数据源名称...\"\r\n        v-model=\"queryForm.name\"\r\n        clearable\r\n        style=\"height: 35px\"\r\n      ></el-input>\r\n    </el-col>\r\n    <el-button type=\"primary\" @click=\"initUserList\">搜索</el-button>\r\n    <el-button color=\"#008997\" type=\"success\" @click=\"handleDialogValue()\"\r\n      >添加</el-button\r\n    >\r\n  </el-row>\r\n  <el-table :data=\"tableData\" stripe style=\"width: 100%\">\r\n    <el-table-column type=\"selection\" width=\"55\" />\r\n    <el-table-column\r\n      prop=\"name\"\r\n      label=\"数据源名称\"\r\n      width=\"150\"\r\n      align=\"center\"\r\n    />\r\n    <el-table-column\r\n      prop=\"type\"\r\n      label=\"数据库类型\"\r\n      width=\"150\"\r\n      :formatter=\"problemSourceFormat\"\r\n      align=\"center\"\r\n    />\r\n    <el-table-column\r\n      prop=\"createdTime\"\r\n      label=\"创建时间\"\r\n      width=\"180\"\r\n      align=\"center\"\r\n    />\r\n    <el-table-column prop=\"creater\" label=\"创建人\" width=\"180\" align=\"center\" />\r\n    <el-table-column\r\n      prop=\"modifiedTime\"\r\n      label=\"修改时间\"\r\n      width=\"180\"\r\n      align=\"center\"\r\n    />\r\n    <el-table-column\r\n      prop=\"modifier\"\r\n      label=\"修改人\"\r\n      align=\"center\"\r\n      width=\"180\"\r\n    />\r\n    <el-table-column prop=\"data\" label=\"操作\" align=\"center\">\r\n      <template v-slot=\"scope\">\r\n        <span class=\"text\" @click=\"handleDialogValue(scope.row.id)\">编辑</span>\r\n        <span\r\n          class=\"text\"\r\n          @click=\"\r\n            deleteId = scope.row.id;\r\n            dialogDelete = true;\r\n          \"\r\n          >删除</span\r\n        >\r\n        <span\r\n          class=\"text ccc\"\r\n          v-loading=\"connectLoading\"\r\n          element-loading-text=\"拼命加载中\"\r\n          @click=\"connect(scope.row.id)\"\r\n          >连接</span\r\n        >\r\n      </template>\r\n    </el-table-column>\r\n  </el-table>\r\n\r\n  <el-pagination\r\n    v-model:currentPage=\"queryForm.current\"\r\n    v-model:page-size=\"queryForm.size\"\r\n    :page-sizes=\"[10, 20, 30, 40, 50]\"\r\n    layout=\"total, sizes, prev, pager, next, jumper\"\r\n    :total=\"total\"\r\n    @size-change=\"handleSizeChange\"\r\n    @current-change=\"handleCurrentChange\"\r\n  />\r\n  <Dialog\r\n    v-model=\"dialogVisible\"\r\n    :dialogVisible=\"dialogVisible\"\r\n    :id=\"id\"\r\n    :dialogTitle=\"dialogTitle\"\r\n    @initUserList=\"initUserList\"\r\n  />\r\n  <el-dialog v-model=\"dialogDelete\" title=\"提示\" width=\"30%\">\r\n    <span style=\"font-size: larger\">您确定要删除这条记录吗？</span>\r\n    <template #footer>\r\n      <span class=\"dialog-footer\">\r\n        <el-button @click=\"dialogDelete = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"deleteById()\"> 确认 </el-button>\r\n      </span>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from \"vue\";\r\nimport requestUtil from \"@/util/request\";\r\nimport Dialog from \"./components/dialog\";\r\nimport { ElMessage } from \"element-plus\";\r\n\r\nconst total = ref(0);\r\nconst tableData = ref(null);\r\nconst dialogVisible = ref(false);\r\nconst dialogDelete = ref(false);\r\nconst dialogTitle = ref(\"\");\r\nconst id = ref(-1);\r\nconst connectLoading = ref(false);\r\nconst deleteId = ref(-1);\r\n\r\nconst initUserList = async () => {\r\n  const res = await requestUtil.get(\r\n    \"admin_api/v1/dataSources\",\r\n    queryForm.value\r\n  );\r\n  tableData.value = res.data.data.records;\r\n  // for (const obj in tableData.value) {\r\n  //   obj.kkkk = false;\r\n  // }\r\n  total.value = res.data.data.total;\r\n};\r\nconst handleDialogValue = (rowId) => {\r\n  if (rowId) {\r\n    id.value = rowId;\r\n    dialogTitle.value = \"数据源修改\";\r\n  } else {\r\n    id.value = -1;\r\n    dialogTitle.value = \"数据源添加\";\r\n  }\r\n  dialogVisible.value = true;\r\n};\r\nconst connect = async (id) => {\r\n  connectLoading.value = true;\r\n  try {\r\n    const res = await requestUtil.get(\r\n      \"admin_api/v1/dataBase/\" + id + \"/connect\"\r\n    );\r\n    if (res.data.success) {\r\n      ElMessage.success(\"连接成功！\");\r\n    } else {\r\n      ElMessage.error(\"连接失败！\");\r\n    }\r\n  } finally {\r\n    connectLoading.value = false;\r\n  }\r\n};\r\nconst deleteById = async () => {\r\n  const res = await requestUtil.post(\r\n    \"admin_api/v1/dataSources/removes\" + \"?ids=\" + deleteId.value\r\n  );\r\n  dialogDelete.value = false;\r\n  initUserList();\r\n};\r\nconst handleSizeChange = (size) => {\r\n  queryForm.value.current = 1;\r\n  queryForm.value.size = size;\r\n  initUserList();\r\n};\r\nconst problemSourceFormat = (date) => {\r\n  if (date.type == \"0\") {\r\n    return \"mysql\";\r\n  }\r\n  if (date.type == \"1\") {\r\n    return \"sqlserver\";\r\n  }\r\n};\r\nconst handleCurrentChange = (current) => {\r\n  queryForm.value.current = current;\r\n  initUserList();\r\n};\r\nconst queryForm = ref({\r\n  name: \"\",\r\n  current: 1,\r\n  size: 10,\r\n});\r\ninitUserList();\r\n</script>\r\n\r\n<style scoped>\r\n.header {\r\n  padding-bottom: 16px;\r\n  box-sizing: border-box;\r\n}\r\n.text {\r\n  cursor: pointer;\r\n  font-size: 0.8rem;\r\n  font-weight: 550;\r\n  background-size: 40px 40px;\r\n  margin: 5px;\r\n  color: #09909f;\r\n}\r\n\r\n.el-pagination {\r\n  float: right;\r\n  padding: 20px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n::v-deep th.el-table__cell {\r\n  word-break: break-word;\r\n  background-color: #f8f8f9 !important;\r\n  color: #515a6e;\r\n  height: 40px;\r\n  font-size: 13px;\r\n}\r\n\r\n.el-tag--small {\r\n  margin-left: 5px;\r\n}\r\n.ccc {\r\n  background-size: 20px 20px !important;\r\n  width: 20px !important;\r\n  height: 20px !important;\r\n}\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=22149f90&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\bs\\\\wxw\\\\xy-dash-admin\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-22149f90\"]])\n\nexport default __exports__"],"names":["form","ref","id","userName","password","type","port","name","ip","rules","required","message","formRef","initFormData","async","res","requestUtil","value","data","connect","validate","valid","success","ElMessage","console","log","watch","props","dialogVisible","handleClose","resetFields","emits","handleConfirm","result","refresh","msg","__exports__","total","tableData","dialogDelete","dialogTitle","connectLoading","deleteId","initUserList","queryForm","records","handleDialogValue","rowId","deleteById","handleSizeChange","size","current","problemSourceFormat","date","handleCurrentChange"],"sourceRoot":""}