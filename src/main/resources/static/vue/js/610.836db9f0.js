"use strict";(self["webpackChunkxy_dash_admin"]=self["webpackChunkxy_dash_admin"]||[]).push([[610,664,238],{5810:function(e,a,l){l.r(a),l.d(a,{default:function(){return m}});var t=l(3396),i=l(4870),o={__name:"migrations",props:{migrationsForm:{type:Object,default:null,required:!0}},setup(e,{expose:a}){const l=(0,i.iH)({count:[{required:!0,message:"请输入每轮条数"}],port:[{required:!0,message:"端口不能为空"}],name:[{required:!0,message:"名称不能为空"}],ip:[{required:!0,message:"主机不能为空"}]}),o=(0,i.iH)(null);(0,i.iH)(1);return a({migrationsFormRef:o}),(a,i)=>{const r=(0,t.up)("el-input"),u=(0,t.up)("el-form-item"),m=(0,t.up)("el-switch"),n=(0,t.up)("el-radio"),s=(0,t.up)("el-radio-group"),d=(0,t.up)("el-form");return(0,t.wg)(),(0,t.j4)(d,{ref_key:"migrationsFormRef",ref:o,model:e.migrationsForm,rules:l.value,"label-width":"300px"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"名称",prop:"name",style:{width:"1000px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.migrationsForm.name,"onUpdate:modelValue":i[0]||(i[0]=a=>e.migrationsForm.name=a),style:{height:"35px"}},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"启动端口",prop:"port",style:{width:"1000px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.migrationsForm.port,"onUpdate:modelValue":i[1]||(i[1]=a=>e.migrationsForm.port=a),style:{height:"35px"}},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"线程数量",prop:"threadCount",style:{width:"1000px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.migrationsForm.threadCount,"onUpdate:modelValue":i[2]||(i[2]=a=>e.migrationsForm.threadCount=a),style:{height:"35px"}},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"每轮条数",prop:"count",style:{width:"1000px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.migrationsForm.count,"onUpdate:modelValue":i[3]||(i[3]=a=>e.migrationsForm.count=a),style:{height:"35px"}},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"是否开启线程",prop:"startThread"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:e.migrationsForm.startThread,"onUpdate:modelValue":i[4]||(i[4]=a=>e.migrationsForm.startThread=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"是否sql拼接",prop:"sqlSpliec"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:e.migrationsForm.sqlSpliec,"onUpdate:modelValue":i[5]||(i[5]=a=>e.migrationsForm.sqlSpliec=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"是否删除",prop:"isDel"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:e.migrationsForm.isDel,"onUpdate:modelValue":i[6]||(i[6]=a=>e.migrationsForm.isDel=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"迁移类型",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{modelValue:e.migrationsForm.type,"onUpdate:modelValue":i[7]||(i[7]=a=>e.migrationsForm.type=a),class:"ml-4"},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{label:"1"},{default:(0,t.w5)((()=>[(0,t.Uk)("id+游标（快）")])),_:1}),(0,t.Wm)(n,{label:"2"},{default:(0,t.w5)((()=>[(0,t.Uk)("时间+游标（中）")])),_:1}),(0,t.Wm)(n,{label:"3"},{default:(0,t.w5)((()=>[(0,t.Uk)("分页（慢）")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(u,{label:"日志路径",prop:"log"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{type:"textarea",modelValue:e.migrationsForm.log,"onUpdate:modelValue":i[8]||(i[8]=a=>e.migrationsForm.log=a),style:{width:"900px",height:"50px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])}}},r=l(89);const u=(0,r.Z)(o,[["__scopeId","data-v-3fe70095"]]);var m=u},1509:function(e,a,l){l.r(a),l.d(a,{default:function(){return v}});l(7658);var t=l(3396),i=l(4870),o=l(9242),r=l(2268),u=l(7412),m=l(1120),n=l(2483),s=l(7178),d=l(5810),p=l(226),g=l(7034);const f=(0,t._)("div",{style:{height:"50px"}},null,-1);var c={__name:"index",setup(e){const a=(0,i.iH)(0),l=(0,i.iH)(null),c=(0,i.iH)(null),h=(0,i.iH)(null),v=(0,i.iH)("下一步"),y=(0,i.iH)({id:-1,name:"",threadCount:null,startThread:!1,port:null,type:"1",count:null,sqlSpliec:!1,isDel:!1,databaseName:[],dataSources:[],data:[],idType:1,migrationDataSources:[{}]}),_=function(){a.value<2&&(a.value=a.value+1);let e=null;2==a.value&&"完成"!=v.value&&(F(),c.value.init()),1==a.value&&(e=l.value.migrationsFormRef),"完成"==v.value&&b(),2==a.value&&(v.value="完成"),null!=e&&e.validate((async e=>{e||(a.value=0)}))},w=function(){a.value=a.value-1,a.value<2&&(v.value="下一步")},b=()=>{let e=JSON.parse(JSON.stringify(y.value));e.migrationDataSources=y.value.migrationDataSources.filter((e=>"{}"!=JSON.stringify(e)&&"{}"!=JSON.stringify(e.migrationTables))),e.migrationDataSources.forEach((e=>{null!=e&&e.migrationTables.forEach((e=>{null!=e&&null!=e.migrationJoinTables&&(e.migrationJoinTables=e.migrationJoinTables.filter((e=>"选择主数据表"!=e.name)))}))}));let a=u.ZP.post("admin_api/v1/migrations",e);a.then((e=>{200==e.data.code&&(m.Z.push("/config/migration"),s.z8.success("操作成功！"))}))},F=()=>{let e=[],l=[],t=!1;0==y.value.migrationDataSources.length&&(t=!0,s.z8.error("库配置不能为空")),y.value.migrationDataSources.filter((e=>"{}"!=JSON.stringify(e))).forEach((a=>{null!=a.uniqueName&&0!=a.uniqueName.trim().length&&null!=a.databaseName&&0!=a.databaseName.trim().length||(t=!0,s.z8.error("缺少必填参数"));let l=a.migrationTables;null!=l&&(l.forEach((e=>{e.uniqueName=a.uniqueName,e.databaseName=a.databaseName,e.sourceId=a.sourceId})),e=e.concat(l))})),y.value.migrationDataSources.filter((e=>"{}"!=JSON.stringify(e))).forEach((a=>{null!=a.migrationTables&&a.migrationTables.forEach((a=>{if(1==a.migration){const t=e.filter((e=>0==e.migration&&e.random==a.random));null!=t&&0!=t.length?(a.sourceName=t[0].name,a.sourceUniqueName=t[0].uniqueName,a.sourceIds=t[0].sourceId,a.sourceDatabaseName=t[0].databaseName):s.z8.error("数据表不能为空！"),l.push(a)}}))})),0==l.length&&0==t&&(t=!0,s.z8.error("表配置不能为空")),1==t&&(a.value=a.value-1),y.value.list=l},W=()=>{const e=(0,n.yj)(),a=e.params.id;if("add"!=a){const e=u.ZP.get("admin_api/v1/migrations/"+a);e.then((e=>{y.value=e.data.data,y.value.databaseName=[],y.value.dataSources=[],y.value.data=[],h.value.tableInit(y.value)}))}};return W(),(e,u)=>{const m=(0,t.up)("el-step"),n=(0,t.up)("el-steps"),s=(0,t.up)("el-button"),b=(0,t.up)("el-col"),F=(0,t.up)("el-row");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(n,{space:200,active:a.value,"finish-status":"success",style:{height:"50px"},simple:""},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{title:"迁移配置"}),(0,t.Wm)(m,{title:"选择表"}),(0,t.Wm)(m,{title:"字段映射"})])),_:1},8,["active"]),f,(0,t.wy)((0,t.Wm)((0,i.SU)(p["default"]),{migrationsForm:y.value,ref_key:"tableChild",ref:h},null,8,["migrationsForm"]),[[o.F8,1==a.value]]),(0,t.wy)((0,t.Wm)((0,i.SU)(d["default"]),{migrationsForm:y.value,ref_key:"migrationsFormChild",ref:l},null,8,["migrationsForm"]),[[o.F8,0==a.value]]),(0,t.wy)((0,t._)("div",null,[(0,t.Wm)((0,i.SU)(g["default"]),{migrationsForm:y.value,ref_key:"fieldChild",ref:c},null,8,["migrationsForm"])],512),[[o.F8,2==a.value]]),(0,t.Wm)(F,{justify:"end"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{span:4},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(s,{type:"primary",onClick:w},{default:(0,t.w5)((()=>[(0,t.Uk)("上一步")])),_:1},512),[[o.F8,0!=a.value]])])),_:1}),(0,t.Wm)(b,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{type:"primary",onClick:_},{default:(0,t.w5)((()=>[(0,t.Uk)((0,r.zw)(v.value),1)])),_:1})])),_:1})])),_:1})],64)}}};const h=c;var v=h}}]);
//# sourceMappingURL=610.836db9f0.js.map