{"version":3,"file":"js/610.836db9f0.js","mappings":"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","sources":["webpack://xy-dash-admin/./src/views/config/migration/operation/components/migrations.vue","webpack://xy-dash-admin/./src/views/config/migration/operation/components/migrations.vue?e497","webpack://xy-dash-admin/./src/views/config/migration/operation/index.vue","webpack://xy-dash-admin/./src/views/config/migration/operation/index.vue?82e7"],"sourcesContent":["<template>\r\n  <el-form\r\n    ref=\"migrationsFormRef\"\r\n    :model=\"migrationsForm\"\r\n    :rules=\"rules\"\r\n    label-width=\"300px\"\r\n  >\r\n    <el-form-item label=\"名称\" prop=\"name\" style=\"width: 1000px\">\r\n      <el-input v-model=\"migrationsForm.name\" style=\"height: 35px\"\r\n    /></el-form-item>\r\n\r\n    <el-form-item label=\"启动端口\" prop=\"port\" style=\"width: 1000px\">\r\n      <el-input v-model=\"migrationsForm.port\" style=\"height: 35px\"\r\n    /></el-form-item>\r\n    <el-form-item label=\"线程数量\" prop=\"threadCount\" style=\"width: 1000px\">\r\n      <el-input v-model=\"migrationsForm.threadCount\" style=\"height: 35px\"\r\n    /></el-form-item>\r\n\r\n    <el-form-item label=\"每轮条数\" prop=\"count\" style=\"width: 1000px\">\r\n      <el-input v-model=\"migrationsForm.count\" style=\"height: 35px\"\r\n    /></el-form-item>\r\n    <el-form-item label=\"是否开启线程\" prop=\"startThread\">\r\n      <el-switch v-model=\"migrationsForm.startThread\"\r\n    /></el-form-item>\r\n    <el-form-item label=\"是否sql拼接\" prop=\"sqlSpliec\">\r\n      <el-switch v-model=\"migrationsForm.sqlSpliec\"\r\n    /></el-form-item>\r\n    <el-form-item label=\"是否删除\" prop=\"isDel\">\r\n      <el-switch v-model=\"migrationsForm.isDel\"\r\n    /></el-form-item>\r\n    <el-form-item label=\"迁移类型\" prop=\"type\">\r\n      <el-radio-group v-model=\"migrationsForm.type\" class=\"ml-4\">\r\n        <el-radio label=\"1\">id+游标（快）</el-radio>\r\n        <el-radio label=\"2\">时间+游标（中）</el-radio>\r\n        <el-radio label=\"3\">分页（慢）</el-radio>\r\n      </el-radio-group></el-form-item\r\n    >\r\n    <el-form-item label=\"日志路径\" prop=\"log\">\r\n      <el-input\r\n        type=\"textarea\"\r\n        v-model=\"migrationsForm.log\"\r\n        style=\"width: 900px; height: 50px\"\r\n      />\r\n    </el-form-item>\r\n  </el-form>\r\n</template>\r\n<script setup>\r\nimport { defineEmits, defineExpose, defineProps, ref, watch } from \"vue\";\r\nconst props = defineProps({\r\n  migrationsForm: {\r\n    type: Object,\r\n    default: null,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst rules = ref({\r\n  count: [{ required: true, message: \"请输入每轮条数\" }],\r\n  port: [{ required: true, message: \"端口不能为空\" }],\r\n  name: [{ required: true, message: \"名称不能为空\" }],\r\n  ip: [{ required: true, message: \"主机不能为空\" }],\r\n});\r\n\r\nconst migrationsFormRef = ref(null);\r\nconst idType = ref(1);\r\n\r\ndefineExpose({\r\n  migrationsFormRef,\r\n});\r\n</script>\r\n<style scoped>\r\n.el-form-item {\r\n  margin-bottom: 25px;\r\n}\r\n</style>\r\n","import script from \"./migrations.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./migrations.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./migrations.vue?vue&type=style&index=0&id=3fe70095&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\bs\\\\wxw\\\\xy-dash-admin\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3fe70095\"]])\n\nexport default __exports__","<template>\r\n  <el-steps\r\n    :space=\"200\"\r\n    :active=\"active\"\r\n    finish-status=\"success\"\r\n    style=\"height: 50px\"\r\n    simple\r\n  >\r\n    <el-step title=\"迁移配置\" />\r\n    <el-step title=\"选择表\" />\r\n    <el-step title=\"字段映射\" />\r\n  </el-steps>\r\n  <div style=\"height: 50px\"></div>\r\n  <Table\r\n    v-show=\"active == 1\"\r\n    :migrationsForm=\"migrationsForm\"\r\n    ref=\"tableChild\"\r\n  />\r\n  <Migrations\r\n    v-show=\"active == 0\"\r\n    :migrationsForm=\"migrationsForm\"\r\n    ref=\"migrationsFormChild\"\r\n  />\r\n  <div v-show=\"active == 2\">\r\n    <Field :migrationsForm=\"migrationsForm\" ref=\"fieldChild\" />\r\n  </div>\r\n  <el-row justify=\"end\">\r\n    <el-col :span=\"4\">\r\n      <el-button type=\"primary\" v-show=\"active != 0\" @click=\"lastStep\"\r\n        >上一步</el-button\r\n      >\r\n    </el-col>\r\n    <el-col :span=\"12\">\r\n      <el-button type=\"primary\" @click=\"nextStep\">{{ msg }}</el-button>\r\n    </el-col>\r\n  </el-row>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, watch } from \"vue\";\r\nimport requestUtil from \"@/util/request\";\r\nimport router from \"@/router/index\";\r\nimport { useRoute } from \"vue-router\";\r\nimport { ElMessage } from \"element-plus\";\r\nimport Migrations from \"./components/migrations\";\r\nimport Table from \"./components/table\";\r\nimport Field from \"./components/field\";\r\nconst active = ref(0);\r\nconst migrationsFormChild = ref(null);\r\nconst fieldChild = ref(null);\r\nconst tableChild = ref(null);\r\nconst msg = ref(\"下一步\");\r\nconst migrationsForm = ref({\r\n  id: -1,\r\n  name: \"\",\r\n  threadCount: null,\r\n  startThread: false,\r\n  port: null,\r\n  type: \"1\",\r\n  count: null,\r\n  sqlSpliec: false,\r\n  isDel: false,\r\n  databaseName: [],\r\n  dataSources: [],\r\n  data: [],\r\n  idType: 1,\r\n  migrationDataSources: [{}],\r\n});\r\n\r\nconst nextStep = function () {\r\n  if (active.value < 2) {\r\n    active.value = active.value + 1;\r\n  }\r\n  let valid = null;\r\n  if (active.value == 2 && msg.value != \"完成\") {\r\n    resetData();\r\n    fieldChild.value.init();\r\n  }\r\n  if (active.value == 1) {\r\n    valid = migrationsFormChild.value.migrationsFormRef;\r\n  }\r\n  if (msg.value == \"完成\") {\r\n    add();\r\n  }\r\n  if (active.value == 2) {\r\n    msg.value = \"完成\";\r\n  }\r\n  if (valid != null) {\r\n    valid.validate(async (valid) => {\r\n      if (valid) {\r\n      } else {\r\n        active.value = 0;\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nconst lastStep = function () {\r\n  active.value = active.value - 1;\r\n  if (active.value < 2) {\r\n    msg.value = \"下一步\";\r\n  }\r\n};\r\n\r\nconst add = () => {\r\n  let data = JSON.parse(JSON.stringify(migrationsForm.value));\r\n  data.migrationDataSources = migrationsForm.value.migrationDataSources.filter(\r\n    (e) =>\r\n      JSON.stringify(e) != \"{}\" && JSON.stringify(e.migrationTables) != \"{}\"\r\n  );\r\n  data.migrationDataSources.forEach((e) => {\r\n    if (e == null) {\r\n      return;\r\n    }\r\n    e.migrationTables.forEach((e) => {\r\n      if (e == null || e.migrationJoinTables == null) {\r\n        return;\r\n      }\r\n      e.migrationJoinTables = e.migrationJoinTables.filter(\r\n        (e) => e.name != \"选择主数据表\"\r\n      );\r\n    });\r\n  });\r\n  let res = requestUtil.post(\"admin_api/v1/migrations\", data);\r\n  res.then((result) => {\r\n    if (result.data.code == 200) {\r\n      router.push(\"/config/migration\");\r\n      ElMessage.success(\"操作成功！\");\r\n    }\r\n  });\r\n};\r\nconst resetData = () => {\r\n  let list = [];\r\n  let tableList = [];\r\n  let update = false;\r\n  if (migrationsForm.value.migrationDataSources.length == 0) {\r\n    update = true;\r\n    ElMessage.error(\"库配置不能为空\");\r\n  }\r\n\r\n  migrationsForm.value.migrationDataSources\r\n    .filter((e) => JSON.stringify(e) != \"{}\")\r\n    .forEach((e) => {\r\n      if (\r\n        e.uniqueName == null ||\r\n        e.uniqueName.trim().length == 0 ||\r\n        e.databaseName == null ||\r\n        e.databaseName.trim().length == 0\r\n      ) {\r\n        update = true;\r\n        ElMessage.error(\"缺少必填参数\");\r\n      }\r\n      let v = e.migrationTables;\r\n      if (v != null) {\r\n        v.forEach((z) => {\r\n          z.uniqueName = e.uniqueName;\r\n          z.databaseName = e.databaseName;\r\n          z.sourceId = e.sourceId;\r\n        });\r\n        list = list.concat(v);\r\n      }\r\n    });\r\n  migrationsForm.value.migrationDataSources\r\n    .filter((e) => JSON.stringify(e) != \"{}\")\r\n    .forEach((e) => {\r\n      if (e.migrationTables != null) {\r\n        e.migrationTables.forEach((v) => {\r\n          if (v.migration == true) {\r\n            const data = list.filter((x) => {\r\n              return x.migration == false && x.random == v.random;\r\n            });\r\n            if (data != null && data.length != 0) {\r\n              v.sourceName = data[0].name;\r\n              v.sourceUniqueName = data[0].uniqueName;\r\n              v.sourceIds = data[0].sourceId;\r\n              v.sourceDatabaseName = data[0].databaseName;\r\n            } else {\r\n              ElMessage.error(\"数据表不能为空！\");\r\n            }\r\n            tableList.push(v);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  if (tableList.length == 0 && update == false) {\r\n    update = true;\r\n    ElMessage.error(\"表配置不能为空\");\r\n  }\r\n  if (update == true) {\r\n    active.value = active.value - 1;\r\n  }\r\n  migrationsForm.value.list = tableList;\r\n};\r\n\r\nconst init = () => {\r\n  const route = useRoute();\r\n  const id = route.params.id;\r\n  if (id != \"add\") {\r\n    const res = requestUtil.get(\"admin_api/v1/migrations/\" + id);\r\n    res.then((result) => {\r\n      migrationsForm.value = result.data.data;\r\n      migrationsForm.value.databaseName = [];\r\n      migrationsForm.value.dataSources = [];\r\n      migrationsForm.value.data = [];\r\n      tableChild.value.tableInit(migrationsForm.value);\r\n    });\r\n  } else {\r\n  }\r\n};\r\ninit();\r\n</script>\r\n\r\n<style scoped></style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["rules","ref","count","required","message","port","name","ip","migrationsFormRef","expose","__exports__","active","migrationsFormChild","fieldChild","tableChild","msg","migrationsForm","id","threadCount","startThread","type","sqlSpliec","isDel","databaseName","dataSources","data","idType","migrationDataSources","nextStep","value","valid","resetData","init","add","validate","async","lastStep","JSON","parse","stringify","filter","e","migrationTables","forEach","migrationJoinTables","res","requestUtil","then","result","code","router","ElMessage","list","tableList","update","length","uniqueName","trim","v","z","sourceId","concat","migration","x","random","sourceName","sourceUniqueName","sourceIds","sourceDatabaseName","push","route","useRoute","params","tableInit"],"sourceRoot":""}